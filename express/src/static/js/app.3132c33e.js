(function(t){function e(e){for(var s,o,r=e[0],c=e[1],u=e[2],d=0,p=[];d<r.length;d++)o=r[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);l&&l(e);while(p.length)p.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],s=!0,r=1;r<n.length;r++){var c=n[r];0!==i[c]&&(s=!1)}s&&(a.splice(e--,1),t=o(o.s=n[0]))}return t}var s={},i={app:0},a=[];function o(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=s,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(n,s,function(e){return t[e]}.bind(null,s));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var u=0;u<r.length;u++)e(r[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0cf1":function(t,e,n){"use strict";var s=n("f47d"),i=n.n(s);i.a},1:function(t,e){},10:function(t,e){},11:function(t,e){},12:function(t,e){},13:function(t,e){},14:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},5:function(t,e){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var s=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",[n("img",{staticClass:"logo",attrs:{src:"images/logo.svg"}}),n("div",{staticClass:"message-container"},t._l(t.computedMessages,(function(e){return n("Message",{key:e.id,attrs:{isFile:e.isFile,text:e.text,name:e.name,content:e.content,timestamp:e.timestamp,senderId:e.senderId,isMine:e.senderId==t.computedSessionData.userId}})})),1),n("div",{staticClass:"message-input-container"},[n("label",{staticClass:"btn file-input",attrs:{title:"Send file"}},[n("i",{staticClass:"fas fa-plus"}),n("input",{attrs:{type:"file"},on:{change:t.readFile}})]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.messageInput,expression:"messageInput"}],attrs:{autofocus:"autofocus",type:"text",placeholder:"Type message here"},domProps:{value:t.messageInput},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage(e)},input:function(e){e.target.composing||(t.messageInput=e.target.value)}}}),n("button",{staticClass:"btn",attrs:{title:"Send message"},on:{click:t.sendMessage}},[n("i",{staticClass:"fas fa-paper-plane"})]),n("button",{staticClass:"btn",attrs:{title:"Copy invite link"},on:{click:t.copyInviteLinkToClipboard}},[n("i",{staticClass:"fas fa-copy"})])]),n("span",{staticClass:"session-data-container"},[t._v(" Room id: "),n("b",[t._v(t._s(t.computedSessionData.conversationId))])])])},a=[],o=(n("b0c0"),n("d3b7"),n("ac1f"),n("25f0"),n("1276"),n("2ca0"),n("3452")),r=n.n(o),c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.computedClass},[n("div",[n("a",{attrs:{href:t.content,download:""}},[t._v(t._s(t.name))]),n("span",{staticClass:"time-created"},[t._v(t._s(t.formatDate(t.timestamp)))])])])},u=[],l=(n("a9e3"),{name:"File",props:{isMine:Boolean,name:String,content:String,timestamp:Number},computed:{computedClass:function(){return this.isMine?"message mine":"message"}},methods:{formatDate:function(t){var e=new Date(t),n=e.getHours(),s=e.getMinutes(),i=n>=12?"pm":"am";n%=12,n=n||12,s=s<10?"0"+s:s;var a=n+":"+s+" "+i;return e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()+"  "+a}}}),d=l,p=(n("0cf1"),n("2877")),f=Object(p["a"])(d,c,u,!1,null,null,null),m=(f.exports,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.computedClass},[n("div",[n("input",{staticClass:"sender",domProps:{value:t.computedAlias},on:{change:t.editAlias}}),t.isImage?n("img",{attrs:{src:t.content}}):t.isAudio?n("audio",{attrs:{controls:"",src:t.content}}):t.isVideo?n("video",{attrs:{controls:"",src:t.content}}):t._e(),t.isFile?n("a",{attrs:{href:t.content,download:t.name}},[t._v(t._s(t.name))]):n("span",{domProps:{innerHTML:t._s(t.computedContent)}}),n("span",{staticClass:"time-created"},[t._v(t._s(t.formatDate(t.timestamp)))])])])}),g=[],h=(n("5319"),{name:"Message",props:{isFile:Boolean,isMine:Boolean,text:String,name:String,content:String,timestamp:Number,senderId:String},computed:{computedContent:function(){var t=this.$store.getters.secret();return this.replaceUrls(r.a.AES.decrypt(this.text,t).toString(r.a.enc.Utf8))},computedAlias:{get:function(){return this.$store.getters.alias(this.senderId)||this.senderId}},isImage:function(){return this.content&&this.content.startsWith("data:image")},isAudio:function(){return this.content&&this.content.startsWith("data:audio")},isVideo:function(){return this.content&&this.content.startsWith("data:video")},computedClass:function(){return this.isMine?"message mine":"message"}},methods:{editAlias:function(t){this.$store.dispatch("setAlias",{key:this.senderId,value:t.target.value})},formatDate:function(t){var e=new Date(t),n=e.getHours(),s=e.getMinutes(),i=n>=12?"pm":"am";n%=12,n=n||12,s=s<10?"0"+s:s;var a=n+":"+s+" "+i;return e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()+"  "+a},replaceUrls:function(t){var e=/(\b(https?|):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,n=t.replace(e,'<a target="_blank" href="$1">$1</a>'),s=/(^|[^\/])(www\.[\S]+(\b|$))/gim,i=n.replace(s,'$1<a target="_blank" href="http://$2">$2</a>');return i}}}),v=h,y=(n("f87e"),Object(p["a"])(v,m,g,!1,null,null,null)),b=y.exports,S={name:"App",data:function(){return{messageInput:"",conversationIdInput:"",tabVisible:!0}},components:{Message:b},computed:{computedSessionData:function(){return this.$store.getters.sessionData()},computedMessages:function(){return this.$store.getters.messages()}},created:function(){var t=this;document.addEventListener("visibilitychange",(function(){return t.tabVisible=!t.tabVisible})),this.$nativeNotifications.permissionGranted()||this.$nativeNotifications.requestPermission()},methods:{readFile:function(t){var e=this,n=t.srcElement.files[0],s=new FileReader;s.readAsDataURL(n),s.onload=function(){e.$store.dispatch("sendFile",{isFile:!0,name:n.name,content:s.result,timestamp:(new Date).getTime()})},s.onerror=function(t){console.log("Error: ",t)}},sendMessage:function(){var t=this.$store.getters.secret();if(this.messageInput.startsWith("/key")){var e=this.messageInput.split(" ")[1]||t;this.$store.dispatch("setSecret",e)}else this.$store.dispatch("sendMessage",{text:r.a.AES.encrypt(this.messageInput,t).toString(),timestamp:(new Date).getTime()});this.messageInput=""},copyInviteLinkToClipboard:function(){var t=window.location.origin+"?room="+this.computedSessionData.conversationId;navigator.clipboard?navigator.clipboard.writeText(t):this.fallbackCopyTextToClipboard(t)},fallbackCopyTextToClipboard:function(t){var e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}catch(n){console.error(n)}document.body.removeChild(e)}}},w=S,D=(n("5c0b"),Object(p["a"])(w,i,a,!1,null,null,null)),I=D.exports,C=(n("4d63"),n("2f62")),_={DENIED:"denied",GRANTED:"granted",DEFAULT:"default"},M=n("d4ec"),E=n("bee2"),A=n("ade3"),T=function(){function t(){var e=this;Object(M["a"])(this,t),Object(A["a"])(this,"permissionGranted",(function(){return e.permissionStatus===_.GRANTED})),this.permissionStatus=localStorage.getItem("native-notifications-permission")}return Object(E["a"])(t,[{key:"setPermissionStatus",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.DEFAULT;localStorage.setItem("native-notifications-permission",t),this.permissionStatus=t}},{key:"requestPermission",value:function(t){var e=this,n=t.onGranted,s=t.onDenied;Notification.requestPermission().then((function(t){e.setPermissionStatus(t),t!==_.DENIED&&t!==_.DEFAULT||s&&s(),t===_.GRANTED&&n&&n()}))}},{key:"notify",value:function(t,e){new Notification(t,{body:e,icon:"/images/logo.png"})}}]),t}(),k=new T;s["a"].use(C["a"]);var x="https:"==window.location.protocol?"wss://":"ws://",O=window.location.host.startsWith("localhost")?"localhost:"+window.location.port:window.location.host;console.log();var $=new WebSocket(x+O),N=new C["a"].Store({state:{sessionData:{userId:null,conversationId:null},messages:[],aliasRegistry:{},secret:"secret123"},mutations:{setSessionData:function(t,e){t.sessionData=e},addMessage:function(t,e){t.messages.push(e)},setAlias:function(t,e){t.aliasRegistry[e.key]=e.value},setSecret:function(t,e){t.secret=e}},actions:{setSessionData:function(t,e){t.commit("setSessionData",e)},addMessage:function(t,e){t.commit("addMessage",e),setTimeout((function(){var t=document.querySelector(".message-container");t.scrollTop=t.scrollHeight+140}),200)},connectToConversation:function(t,e){$.send(JSON.stringify({type:"CONNECT",payload:e}))},sendMessage:function(t,e){$.send(JSON.stringify({type:"MESSAGE",payload:e}))},sendFile:function(t,e){$.send(JSON.stringify({type:"FILE",payload:e}))},setAlias:function(t,e){t.commit("setAlias",e)},setSecret:function(t,e){t.commit("setSecret",e)}},getters:{sessionData:function(t){return function(){return t.sessionData}},messages:function(t){return function(){return t.messages}},alias:function(t){return function(e){return t.aliasRegistry[e]}},secret:function(t){return function(){return t.secret}}}}),F=function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),s=n.exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null};$.onopen=function(){var t=F("room");t&&N.dispatch("connectToConversation",{conversationId:t})},$.onmessage=function(t){t=JSON.parse(t.data),"SESSION_DATA"==t.type?N.dispatch("setSessionData",t.payload):"MESSAGE"==t.type?(k.permissionGranted()&&k.notify("Secretman.ga","Someone has sent a message"),N.dispatch("addMessage",t.payload)):"FILE"==t.type&&(k.permissionGranted()&&k.notify("Secretman.ga","Someone has sent a message"),t.payload.isFile=!0,N.dispatch("addMessage",t.payload))};var j=N,P={install:function(t){t.prototype.$nativeNotifications=k}};s["a"].config.productionTip=!1,s["a"].use(P),new s["a"]({store:j,render:function(t){return t(I)}}).$mount("#app")},"5c0b":function(t,e,n){"use strict";var s=n("9c0c"),i=n.n(s);i.a},6:function(t,e){},7:function(t,e){},8:function(t,e){},9:function(t,e){},"9c0c":function(t,e,n){},afbc:function(t,e,n){},f47d:function(t,e,n){},f87e:function(t,e,n){"use strict";var s=n("afbc"),i=n.n(s);i.a}});
//# sourceMappingURL=app.3132c33e.js.map